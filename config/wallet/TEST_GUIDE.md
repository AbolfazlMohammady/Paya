# ุฑุงูููุง ุชุณุช ุดุงุฑฺ ฺฉู ูพูู ุจุง ุฏุฑฺฏุงู ุณูพูุฑ

ุฏุฑ ุงู ุณูุฏ ูุฑุงูุฏ ฺฉุงูู ุชุณุช ุฏุฑฺฏุงู ยซูพุฑุฏุงุฎุช ุงูฺฉุชุฑููฺฉ ุณูพูุฑ (ุจุงูฺฉ ุตุงุฏุฑุงุช)ยป ุฏุฑ ูุญุท ุชูุณุนู ุชุดุฑุญ ูโุดูุฏ.

---

## ๐ง ูพฺฉุฑุจูุฏ ูุญุท

```env
BASE_URL=http://localhost:8000             # ุขุฏุฑุณ ุจุงุฒฺฏุดุชุ ุจุฑุง ุชุณุช ุนููู ุงุฒ ngrok ุง ุฏุงููู ูุงูุน ุงุณุชูุงุฏู ฺฉูุฏ
PAYMENT_GATEWAY_DEFAULT=sepehr
SEPEHR_ENABLED=True
SEPEHR_TERMINAL_ID=98743989               # ููุฏุงุฑ ูููููุ ุฏุฑ ูุญุท ูุงูุน ููุฏุงุฑ ุงุตู ุฑุง ูุฑุงุฑ ุฏูุฏ
SEPEHR_TOKEN_URL=https://sepehr.shaparak.ir/Rest/V1/PeymentApi/GetToken
SEPEHR_PAYMENT_URL=https://sepehr.shaparak.ir/Payment/Pay
SEPEHR_ADVICE_URL=https://sepehr.shaparak.ir/Rest/V1/PeymentApi/Advice
SEPEHR_ROLLBACK_URL=https://sepehr.shaparak.ir/Rest/V1/PeymentApi/Rollback
SEPEHR_TIMEOUT=10
SEPEHR_DEFAULT_PAYLOAD=

# ุจุฑุง ุชุณุช ุจุฏูู ุงุชุตุงู ุจู ุฏุฑฺฏุงูุ ุญุงูุช Mock ุฑุง ูุนุงู ฺฉูุฏ (ููุท ุฏุฑ ุชูุณุนู)
SEPEHR_MOCK_MODE=True
```

> ุฏุฑ ูุญุท production ููุฏุงุฑ `SEPEHR_MOCK_MODE` ุจุงุฏ ุญุฐู ุง ุจุฑุงุจุฑ False ุจุงุดุฏ ุชุง ุฏุฑุฎูุงุณุชโูุง ุจู ุฏุฑฺฏุงู ูุงูุน ุงุฑุณุงู ุดูุฏ.

---

## ๐งช ููู ฺฉุงูู ุชุณุช ุดุงุฑฺ

### ูุฑุญูู 1: ูุงฺฏู ู ุฏุฑุงูุช Token

```bash
# ูุงฺฏู
POST http://localhost:8000/api/core/login/
{
  "phone": "09123456789"
}

# Verify
POST http://localhost:8000/api/core/verify/
{
  "phone": "09123456789",
  "code": "1234"
}
```

### ูุฑุญูู 2: ุจุฑุฑุณ ูุถุนุช ฺฉู ูพูู

> ุงุฒ ูุณุฎู ูุนู ุจู ุจุนุฏ ฺฉู ูพูู ูุฑ ฺฉุงุฑุจุฑ ุฏุฑ ูุญุธู ุณุงุฎุช User ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ (signal) ุงุฌุงุฏ ูโุดูุฏ. ฺฉุงู ุงุณุช ูุถุนุช ุขู ุฑุง ุจุฑุฑุณ ฺฉูุฏ.

```bash
GET http://localhost:8000/api/wallet/me/
Authorization: Bearer <access_token>
```

ุงฺฏุฑ ูพุงุณุฎ 404 ุฏุฑุงูุช ฺฉุฑุฏุฏุ ุนู signal ุงุฌุฑุง ูุดุฏู ุง ฺฉุงุฑุจุฑ ุจุฏูู ฺฉู ูพูู ุงุฌุงุฏ ุดุฏู ุงุณุชุ ุฏุฑ ุงู ุตูุฑุช ูโุชูุงูุฏ ููฺูุงู ุงุฒ endpoint ุงุฌุงุฏ ฺฉู ูพูู ุงุณุชูุงุฏู ฺฉูุฏ.

### ูุฑุญูู 3: ุฏุฑุฎูุงุณุช ุดุงุฑฺ (Mock ุง ูุงูุน)

```bash
POST http://localhost:8000/api/wallet/charge-gateway/
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "amount": 1000,
  "description": "ุชุณุช ุดุงุฑฺ ฺฉู ูพูู"
}
```

**ูพุงุณุฎ ูููู ุฏุฑ ุญุงูุช Mock:**

```json
{
  "request_id": "req_abc123def456",
  "payment_url": "https://sepehr.shaparak.ir/Payment/Pay?token=ACCESS_TOKEN&terminalId=12345678",
  "authority": "ACCESS_TOKEN",
  "amount": 1000,
  "gateway": "sepehr",
  "expires_at": "2025-01-01T13:00:00Z"
}
```

### ูุฑุญูู 4: ูุฏุงุช ฺฉุงุฑุจุฑ ุจู ุตูุญู ูพุฑุฏุงุฎุช (ููุท ุฏุฑ ุตูุฑุช ุงุชุตุงู ูุงูุน)

ุฏุฑ ุญุงูุช Mock ูุงุฒ ุจู ุจุงุฒ ฺฉุฑุฏู `payment_url` ูุณุช. ุจุฑุง ุงุชุตุงู ูุงูุนุ ฺฉุงุฑุจุฑ ุจุงุฏ ุจู ุตูุญู ูพุฑุฏุงุฎุช ุฏุฑฺฏุงู (ุณูพูุฑ) ูุฏุงุช ุดูุฏ.

### ูุฑุญูู 5: ุดุจูโุณุงุฒ Callback ุฏุฑ ุญุงูุช Mock

ุฏุฑ ุญุงูุช Mock ุง ุฒูุงู ฺฉู ุฏุฑฺฏุงู ุจู callback ุดูุง ุฏุณุชุฑุณ ูุฏุงุฑุฏุ ูพุงุณุฎ ุฑุง ุจู ุตูุฑุช ุฏุณุช POST ฺฉูุฏ:

```bash
POST http://localhost:8000/api/wallet/payment-callback/
Content-Type: application/json

{
  "respcode": "0",
  "invoiceid": "req_abc123def456",          # ููุงู request_id ุฏุฑุงูุช ุงุฒ ูุฑุญูู ูุจู
  "digitalreceipt": "MOCK_RECEIPT_1",       # ุดูุงุณู ฺฉุชุง (ุฏูุฎูุงู)
  "Authority": "MOCK_TOKEN_..."             # ููุงู authority ุฏุฑุงูุช ุงุฒ ูุฑุญูู ูุจู
}
```

> ุฏุฑ ุงุชุตุงู ูุงูุนุ ููุงุฏุฑ `invoiceid` ู `digitalreceipt` ุจุงุฏ ูุทุงุจู ุฏุงุฏูโูุง ุงุฑุณุงู ุณูพูุฑ ุจุงุดุฏ. ุฏุฑ ุญุงูุช Mockุ ููุงุฏุฑ ุณุงุฎุชฺฏ ฺฉุงู ุงุณุช.

### ูุฑุญูู 6: ุจุฑุฑุณ ูุถุนุช ูพุฑุฏุงุฎุช

```bash
GET http://localhost:8000/api/wallet/payment-status/{request_id}/
Authorization: Bearer <access_token>
```

**ูพุงุณุฎ ููููู (ูพุณ ุงุฒ callback ูููู):**

```json
{
  "request_id": "req_abc123def456",
  "amount": 1000,
  "status": "completed",
  "gateway": "sepehr",
  "authority": "ACCESS_TOKEN",
  "ref_id": "MOCK_RECEIPT_1",
  "transaction_id": "txn_abc123",
  "balance_after": 1000,
  "created_at": "...",
  "updated_at": "..."
}
```

### ูุฑุญูู 7: ุจุฑุฑุณ ููุฌูุฏ

```bash
GET http://localhost:8000/api/wallet/balance/
Authorization: Bearer <access_token>
```

---

## ๐ผ๏ธ ุฏุฑุงูุช ุชุตูุฑ QR ุณูุช ุณุฑูุฑ

ุงุฒ ูุณุฎูโ ุฌุฏุฏุ ุนูุงูู ุจุฑ ูุชุงุฏุชุง QR ูโุชูุงูุฏ ุฎูุฏ ุชุตูุฑ QR ุฑุง ูู ุงุฒ ุณุฑูุฑ ุฏุฑุงูุช ฺฉูุฏุ ุงู ูุงุจูุช ุจุฑุง ุงูพูฺฉุดู Flutter ููุฏ ุงุณุช ุชุง ุจุฏูู ูุงุจุณุชฺฏ ุจู ฺฉุชุงุจุฎุงููโูุง ุชููุฏ QRุ ุชุตูุฑ ุขูุงุฏู ุฑุง ููุงุด ุฏูุฏ.

### Endpoint

```
GET /api/wallet/qr/image/?qr_payload=<payload>&size=<optional>
```

- **qr_payload** (ุงุฌุจุงุฑ): ููุงู ููุฏุงุฑ ฺฉู ุงุฒ `POST /api/wallet/qr/generate/` ุง `POST /api/wallet/qr/lookup/` ุฏุฑุงูุช ูโฺฉูุฏ.
- **size** (ุงุฎุชุงุฑ): ุงูุฏุงุฒูโ ูุฑุจุน ุฎุฑูุฌ ุจุฑ ุญุณุจ ูพฺฉุณู. ููุฏุงุฑ ุจู ฑฒธ ุชุง ฑฐฒด ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดูุฏ. ุฏุฑ ุตูุฑุช ุนุฏู ุงุฑุณุงูุ ุงูุฏุงุฒูโ ูพุดโูุฑุถ ุจุฑ ุงุณุงุณ ุชูุธูุงุช QR ุงุณุช.

### ููููู ุฏุฑุฎูุงุณุช

```bash
curl -L \
  -H "Authorization: Bearer <access_token>" \
  "http://localhost:8000/api/wallet/qr/image/?qr_payload=qr_123ABC456&size=512" \
  --output qr_123ABC456.png
```

### ูฺฉุงุช

- ูพุงุณุฎ ุจู ุตูุฑุช `image/png` ุงุณุช ู ูุฏุฑ `X-QR-Status` ูุถุนุช ูุนู QR (`active`, `used`, `expired`) ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.
- ุงฺฏุฑ QR ูููุถ ุดุฏู ุจุงุดุฏุ ูพุงุณุฎ ุฎุทุง ดฐฐ ุจุง ูพุงู `QR code is expired` ุฏุฑุงูุช ูโฺฉูุฏ.
- ุฏุฑ Flutter ูโุชูุงูุฏ ุงุฒ `Image.network` ุจุฑุง ุฑูุฏุฑ ูุณุชูู ุงุณุชูุงุฏู ฺฉูุฏ ุง ูุงู ุฑุง ุจุฑุง ุงุณุชูุงุฏูโ ุขููุงู ุฐุฎุฑู ฺฉูุฏ.
- ุจุฑุง QRูุง ูุนุงูุ ูพุงุณุฎ ุจุง `Cache-Control: max-age=300` ุจุฑูโฺฏุฑุฏุฏ ุชุง ฺฉูุงูุช ุจุชูุงูุฏ ฺฉุด ฺฉูุชุงูโูุฏุช ุฏุงุดุชู ุจุงุดุฏ.

---

## ๐งช ุชุณุช ุงูุชูุงู ูุฌู (ููุช ุฑูุด)

Endpoint ูุดุชุฑฺฉ: `POST /api/wallet/transfer/`

Headers:

```
Authorization: Bearer <access_token>
Content-Type: application/json
```

| ููุฏุงุฑ `method` | ุชูุถุญ ุณูุงุฑู                                                                     | ฺฉูุฏูุง ููู ุฏุฑ ุจุฏูู             |
| --------------------- | ------------------------------------------------------------------------------------------- | ----------------------------------------------- |
| `phone`             | ุงูุชูุงู ุจู ุดูุงุฑู ููุจุงู ุขุฒุงุฏ                                          | `recipient_phone`                             |
| `contact`           | ุงูุชูุงู ุจู ูุฎุงุทุจ ุฐุฎุฑูโุดุฏู (ููุงู ููุจุงู ุจุง ูุชุงุฏุชุง) | `recipient_phone`, `metadata.contact_id`    |
| `wallet`            | ุงูุชูุงู ุจู ุดูุงุณู ฺฉู ูพูู ูุดุฎุต                                         | `recipient_wallet_id`                         |
| `qr`                | ุงูุชูุงู ุจุง QR Code                                                                   | `metadata.qr_payload` ุง `metadata.qr_id` |
| `iban`              | ุงูุชูุงู ุจู ุดูุงุฑู ุดุจุง ุฏุงุฎู                                              | `metadata.iban`                               |
| `card`              | ุงูุชูุงู ุจู ุดูุงุฑู ฺฉุงุฑุช ุฏุงุฎู                                            | `metadata.card_number`                        |
| `link`              | ุงูุชูุงู ุงุฒ ุทุฑู ููฺฉ ูพุฑุฏุงุฎุช ุฏุงุฎู                                 | `metadata.payment_link_id`                    |

### ๐งพ ุงูุชูุงู ุจุง QR (ฺฉุงููุงู ูุฑุญููโุง)

ุฏุฑ ุงูุชูุงู ุจุง QR ุณู ูุฑุญูู ุฏุงุฑุฏ: **ุชููุฏ QR**ุ **ููุงุด ุจู ฺฉุงุฑุจุฑ (ูุชุงุฏุชุง + ุชุตูุฑ)**ุ ู **ุงุฌุฑุง ุงูุชูุงู**.

1. **ุชููุฏ QR**
   ```bash
   POST /api/wallet/qr/generate/
   Authorization: Bearer <access_token>
   Content-Type: application/json

   {
     "amount": 60000,
     "description": "QR ุชุณุช",
     "expires_in": 600
   }
   ```
   ุฎุฑูุฌ ุดุงูู `qr_payload`, `qr_content`, `expires_at` ู ... ุงุณุช. ุงู ูพุงุณุฎ ุฑุง ุฐุฎุฑู ฺฉูุฏุ `qr_payload` ุดูุงุณูโ ุงุตู ุงุณุช.

2. **ููุงุด ู ุขูุงุฏูโุณุงุฒ ุจุฑุง ุงูพูฺฉุดู (Flutter)**
   - **ูุชุงุฏุชุง**: ุจุง `POST /api/wallet/qr/lookup/` ู ุจุฏููโ `{ "qr_payload": "qr_..." }`ุ ุตุญุช QR ุฑุง ุฏุฑ ูุญุธู ููุงุด ุจุฑุฑุณ ฺฉูุฏ (ูุถุนุชุ ูุจูุบุ ูุงูฺฉ).
   - **ุชุตูุฑ ุขูุงุฏู**: ุงฺฏุฑ ูโุฎูุงูุฏ ุงุฒ ุณุฑูุฑ ุชุตูุฑ ุฑุง ุจฺฏุฑุฏ (ูุงุฒ ุจู ฺฉุชุงุจุฎุงููโ QR ุฏุฑ Flutter ูุจุงุดุฏ)ุ ุงุฒ endpoint ุฌุฏุฏ ุงุณุชูุงุฏู ฺฉูุฏ:
     ```bash
     GET /api/wallet/qr/image/?qr_payload=qr_123ABC456&size=512
     Authorization: Bearer <access_token>
     ```
     ูุงู ุฑุง ูโุชูุงูุฏ ูุณุชููุงู ุจุง `Image.network` ููุงุด ุฏูุฏ ุง ุฏุงูููุฏ ฺฉุฑุฏู ู ุขููุงู ูฺฏู ุฏุงุฑุฏ. ุงฺฏุฑ QR ูููุถ ุดุฏู ุจุงุดุฏุ ูพุงุณุฎ ดฐฐ ุจุฑูโฺฏุฑุฏุฏุ ุฏุฑ ุงู ุญุงูุช ุจุงุฏ QR ุฌุฏุฏ ุชููุฏ ุดูุฏ.

3. **ุงุฌุฑุง ุงูุชูุงู ุจุง QR**
   ```json
   {
     "method": "qr",
     "amount": 60000,                   // ุฏุฑ ุตูุฑุช ุฏุงุดุชู ูุจูุบ ุซุงุจุชุ ูโุชูุงูุฏ ุงู ููุฏ ุฑุง ุญุฐู ฺฉูุฏ
     "metadata": {
       "qr_payload": "qr_123ABC456"
     }
   }
   ```
   ุณุฑูุฑ ููุฌูุฏ ุงุฑุณุงูโฺฉููุฏู ุฑุง ฺฺฉ ูโฺฉูุฏุ ูุชุงุฏุชุง ุฑุง ุงุฒ QR ูพุฑ ูโฺฉูุฏ ู ูพุณ ุงุฒ ููููุชุ ูุถุนุช QR ุฑุง `used` ูโฺฉูุฏ. ุงฺฏุฑ QR ูููุถ ุดุฏู ุจุงุดุฏ (ุง ูุจูุงู ุงุณุชูุงุฏู ุดุฏู ุจุงุดุฏ)ุ ูพุงุณุฎ ุฎุทุง ดฐฐ ุฏุฑุงูุช ูโฺฉูุฏ.

> **ูฺฉุชู:** ุงฺฏุฑ QR ูุจูุบ ุซุงุจุช ุฏุงุฑุฏุ `amount` ุฏุฑ ูุชุงุฏุชุง ุฐุฎุฑู ูโุดูุฏ ู ูุงุฒ ุจู ุงุฑุณุงู ุฏูุจุงุฑู ูุณุชุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ุจุงุฏ ุฏุฑ ุฒูุงู ุงูุชูุงูุ ูุจูุบ ุฑุง ุฏุฑ ุจุฏููโ ุฏุฑุฎูุงุณุช ุจูุฑุณุชุฏ. ุญุฏุงูู ูุจูุบ ุงูุชูุงู ฑฐูุฒุงุฑ ุชููุงู ุงุณุช.

### ููููู ุฏุฑุฎูุงุณุชโูุง (ุณุงุฑ ุฑูุดโูุง)

**1. ุงูุชูุงู ุจุง ุดูุงุฑู ููุจุงู (phone)**

```json
{
  "method": "phone",
  "recipient_phone": "+989121234567",
  "amount": 50000,
  "description": "ุจุงุฒูพุฑุฏุงุฎุช ูุฑุถ",
  "metadata": {
    "note": "ุงูุชูุงู ุณุฑุน"
  }
}
```

**2. ุงูุชูุงู ุจู ูุฎุงุทุจ (contact)**

```json
{
  "method": "contact",
  "recipient_phone": "+989121234567",
  "amount": 75000,
  "metadata": {
    "contact_id": "cnt_42",
    "note": "ุงูุชูุงู ุจู ูุฎุงุทุจ ุฐุฎุฑูโุดุฏู"
  }
}
```

**3. ุงูุชูุงู ุจู ุดูุงุณู ฺฉู ูพูู (wallet)**

```json
{
  "method": "wallet",
  "recipient_wallet_id": 123,
  "amount": 150000,
  "description": "ุชุณูู ุฏุงุฎู"
}
```

**4. ุงูุชูุงู ุจุง QR (qr)**

```json
{
  "method": "qr",
  "amount": 90000,
  "metadata": {
    "qr_payload": "QR_CODE_RAW_DATA"
  }
}
```

**5. ุงูุชูุงู ุจุง ุดูุงุฑู ุดุจุง (iban)**

```json
{
  "method": "iban",
  "amount": 200000,
  "metadata": {
    "iban": "IR820540102680020817909002",
    "note": "ุงูุชูุงู ุจู ุดุจุง ุฏุงุฎู"
  }
}
```

**6. ุงูุชูุงู ุจุง ุดูุงุฑู ฺฉุงุฑุช (card)**

```json
{
  "method": "card",
  "amount": 120000,
  "metadata": {
    "card_number": "5022291234567890",
    "note": "ุงูุชูุงู ฺฉุงุฑุช ุจู ฺฉุงุฑุช ุฏุงุฎู"
  }
}
```

**7. ุงูุชูุงู ุจุง ููฺฉ ูพุฑุฏุงุฎุช (link)**

```json
{
  "method": "link",
  "amount": 300000,
  "metadata": {
    "payment_link_id": "pl_9812",
    "note": "ุชุณูู ุงุฒ ุทุฑู ููฺฉ"
  }
}
```

### ุจุฑุฑุณ ูพุงุณุฎ

ุจุฑุง ููู ุฑูุดโูุง ูพุงุณุฎ ุงุณุชุงูุฏุงุฑุฏ ุจู ุดฺฉู ุฒุฑ ุงุณุช:

```json
{
  "transaction_id": "txn_123abc",
  "amount": 50000,
  "recipient": {
    "phone": "09121234567",
    "fullname": "ฺฉุงุฑุจุฑ ุฏุฑุงูุชโฺฉููุฏู"
  },
  "balance_after": 1250000,
  "status": "completed",
  "created_at": "2025-01-01T10:45:12Z",
  "method": "phone",
  "metadata": {
    "direction": "outgoing",
    "recipient_wallet_id": 123,
    "note": "ุงูุชูุงู ุณุฑุน"
  }
}
```

ูพุณ ุงุฒ ูุฑ ุงูุชูุงูุ ูโุชูุงูุฏ ุจุง `GET /api/wallet/transactions/` ููุฑุณุช ุชุฑุงฺฉูุดโูุง ุฑุง ูุดุงูุฏู ฺฉุฑุฏู ู ุณุชูู `method` ู `metadata` ุฑุง ุจุฑุง ุตุญุช ุชุณุช ุจุฑุฑุณ ฺฉูุฏ.

---

## ๐ ุนุจโุงุจ

### ุฎุทุง: "Sepehr gateway is disabled"

- ููุฏุงุฑ `SEPEHR_ENABLED=True` ูุณุช ุง ุชูุธูุงุช ุฏุฑ `PAYMENT_GATEWAYS` ูุงูุต ุงุณุช.

### ุฎุทุง: "Unsupported payment gateway"

- ุงุญุชูุงูุงู ุฏุฑุฎูุงุณุช ูุฏู ุจุง ููุฏ `gateway` ุงุฑุณุงู ุดุฏู ุงุณุช. ููุฏ ุฑุง ุญุฐู ฺฉูุฏ ุชุง ุฏุฑฺฏุงู ุณูพูุฑ ุจู ุตูุฑุช ูพุดโูุฑุถ ุงุณุชูุงุฏู ุดูุฏ.

### ุฎุทุง: "Payment request failed" ุง "Payment verification failed"

- ุตุญุช `SEPEHR_TERMINAL_ID`ุ ุขุฏุฑุณโูุง ุณุฑูุณ ู ููุงุฏุฑ `invoiceid`, `digitalreceipt` ุฑุง ุจุฑุฑุณ ฺฉูุฏ.
- ูุทูุฆู ุดูุฏ ุฏุฑุฎูุงุณุช Advice ุจุง JSON ุตุญุญ ุงุฑุณุงู ุดุฏู ุงุณุช.

### ุฎุทุง: Callback ฺฉุงุฑ ููโฺฉูุฏ

- ุฏุฑ ูุญุท ููฺฉุงู ุจุฑุง ุณูพูุฑ ุจุงุฏ ุงุฒ ngrok ุง ุณุฑูุณ ูุดุงุจู ุงุณุชูุงุฏู ฺฉูุฏ ุง ุฏุงุฏู ุฑุง ุจู ุตูุฑุช ุฏุณุช POST ููุงุฏ (ููุงูโุทูุฑ ฺฉู ุฏุฑ ูุฑุญูู ต ุชูุถุญ ุฏุงุฏู ุดุฏ).
- ุงฺฏุฑ ุญุงูุช Mock ูุนุงู ุงุณุช ูู ูููุฒ ุจู ุฏุฑฺฏุงู ูุงูุน ูุตู ูโุดูุฏุ ููุฏุงุฑ `SEPEHR_MOCK_MODE=True` ุฏุฑ `.env` ุฑุง ุจุฑุฑุณ ู ุณุฑูุณ ุฑุง ุฑโุงุณุชุงุฑุช ฺฉูุฏ. ุฏุฑ ูพุงุณุฎโูุง Mock ููุฏุงุฑ `mock_mode: true` ุฏุฑ `debug_info` ูุงุจู ูุดุงูุฏู ุงุณุช.

---

## ๐ ุชุณุช ุฎูุฏฺฉุงุฑ (ููููู ุงุณฺฉุฑูพุช Python)

```env
PAYMENT_GATEWAY_DEFAULT=sepehr
```

```python
import requests

BASE_URL = "http://localhost:8000"
TOKEN = "your-access-token"

# ุฏุฑุฎูุงุณุช ุดุงุฑฺ
response = requests.post(
    f"{BASE_URL}/api/wallet/charge-gateway/",
    headers={"Authorization": f"Bearer {TOKEN}"},
    json={
        "amount": 1000,
        "description": "ุชุณุช"
    }
)

data = response.json()
print(f"Payment URL: {data['payment_url']}")
print(f"Request ID: {data['request_id']}")

# ุฏุฑ ุญุงูุช Mockุ callback ุฑุง ุจู ุตูุฑุช ุฏุณุช ุตุฏุง ูโุฒูู
requests.post(
    f"{BASE_URL}/api/wallet/payment-callback/",
    json={
        "respcode": "0",
        "invoiceid": data["request_id"],
        "digitalreceipt": "MOCK_RECEIPT_SCRIPT",
        "Authority": data["authority"],
    }
)

# ุจุนุฏ ุงุฒ callbackุ ุจุฑุฑุณ ูุถุนุช
status_response = requests.get(
    f"{BASE_URL}/api/wallet/payment-status/{data['request_id']}/",
    headers={"Authorization": f"Bearer {TOKEN}"}
)

print(status_response.json())
```

## โ ฺฺฉโูุณุช ุชุณุช

- [ ] `SEPEHR_TERMINAL_ID` ู ุณุงุฑ ุชูุธูุงุช ุฏุฑ `.env` ููุฏุงุฑุฏู ุดุฏูโุงูุฏ.
- [ ] ฺฉู ูพูู ุงุฌุงุฏ ุดุฏู
- [ ] ุฏุฑุฎูุงุณุช ุดุงุฑฺ ูููู ุงุณุช (ุฏุฑ ุญุงูุช Mock ููุฏุงุฑ `mock_mode` ุฑุง ุจุฑุฑุณ ฺฉูุฏ)
- [ ] payment_url ู authority ุฏุฑุงูุช ุดุฏูโุงูุฏ
- [ ] Callback (ูุงูุน ุง ุดุจูโุณุงุฒโุดุฏู) ุจู ุฏุฑุณุช ุงุฑุณุงู ูโุดูุฏ
- [ ] ฺฉู ูพูู ุดุงุฑฺ ูโุดูุฏ
- [ ] ุชุฑุงฺฉูุด ุซุจุช ูโุดูุฏ
