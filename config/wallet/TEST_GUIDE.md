# ุฑุงูููุง ุชุณุช ฺฉู ูพูู ูพุงุง

ุฏุฑ ุงู ุณูุฏ ูุฑุงูุฏ ฺฉุงูู ุชุณุช ุณุฑูุณ ฺฉู ูพูู ูพุงุง ุฏุฑ ูุญุท ุชูุณุนู ุชุดุฑุญ ูโุดูุฏ.

---

## ๐ง ูพฺฉุฑุจูุฏ ูุญุท

```env
BASE_URL=http://localhost:8000
PAYMENT_GATEWAY_DEFAULT=sepehr
SEPEHR_ENABLED=True
SEPEHR_TERMINAL_ID=98743989
SEPEHR_MOCK_MODE=True  # ุจุฑุง ุชุณุช ุจุฏูู ุงุชุตุงู ุจู ุฏุฑฺฏุงู ูุงูุน
```

---

## ๐งช ููู ฺฉุงูู ุชุณุช ุดุงุฑฺ

### ูุฑุญูู 1: ูุงฺฏู ู ุฏุฑุงูุช Token

```bash
# ูุงฺฏู
POST http://localhost:8000/api/core/login/
{
  "phone": "09123456789"
}

# Verify
POST http://localhost:8000/api/core/verify/
{
  "phone": "09123456789",
  "code": "1234"
}
```

### ูุฑุญูู 2: ุจุฑุฑุณ ูุถุนุช ฺฉู ูพูู

> ฺฉู ูพูู ูุฑ ฺฉุงุฑุจุฑ ุฏุฑ ูุญุธู ุณุงุฎุช User ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ (signal) ุงุฌุงุฏ ูโุดูุฏ.

```bash
GET http://localhost:8000/api/wallet/me/
Authorization: Bearer <access_token>
```

**ูพุงุณุฎ ููููู:**

```json
{
  "id": 1,
  "balance": "0.00",
  "currency": "IRR",
  "status": "active",
  "wallet_address": "PAYA123456789012345678",
  "created_at": "2025-01-15T10:30:00Z",
  "updated_at": "2025-01-15T10:30:00Z",
  "formatted_balance": "ฐ ุชููุงู"
}
```

**ูฺฉุชู ููู:** ูุฑ ฺฉู ูพูู ฺฉ `wallet_address` 24 ุฑูู ุฏุงุฑุฏ ฺฉู ุจุง `PAYA` ุดุฑูุน ูโุดูุฏ. ุงู ุขุฏุฑุณ ุจุฑุง ุงูุชูุงู ุฏุฑูู ุดุจฺฉู ุงุณุชูุงุฏู ูโุดูุฏ.

### ูุฑุญูู 3: ุฏุฑุฎูุงุณุช ุดุงุฑฺ

```bash
POST http://localhost:8000/api/wallet/charge-gateway/
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "amount": 100000,
  "description": "ุชุณุช ุดุงุฑฺ ฺฉู ูพูู"
}
```

### ูุฑุญูู 4: ุดุจูโุณุงุฒ Callback (ุฏุฑ ุญุงูุช Mock)

```bash
POST http://localhost:8000/api/wallet/payment-callback/
Content-Type: application/json

{
  "respcode": "0",
  "invoiceid": "req_abc123def456",
  "digitalreceipt": "MOCK_RECEIPT_1",
  "Authority": "MOCK_TOKEN_..."
}
```

### ูุฑุญูู 5: ุจุฑุฑุณ ููุฌูุฏ

```bash
GET http://localhost:8000/api/wallet/balance/
Authorization: Bearer <access_token>
```

---

## ๐งช ุชุณุช ุงูุชูุงู ูุฌู ุฏุฑูู ุดุจฺฉู (ุญููู ุจุณุชู)

**ูฺฉุชู ููู:** ุชูุงู ุงูุชูุงูโูุง ุฏุฑูู ุดุจฺฉู ูุณุชูุฏ. ูฺ ุงูุชูุงู ุจู ุญุณุงุจ ุจุงูฺฉ ุฎุงุฑุฌ ุงุฒ ุดุจฺฉู ูุฌูุฏ ูุฏุงุฑุฏ.

Endpoint ูุดุชุฑฺฉ: `POST /api/wallet/transfer/`

Headers:

```
Authorization: Bearer <access_token>
Content-Type: application/json
```

| ููุฏุงุฑ `method` | ุชูุถุญ ุณูุงุฑู                                           | ฺฉูุฏูุง ููู ุฏุฑ ุจุฏูู                    |
| --------------------- | ----------------------------------------------------------------- | ------------------------------------------------------ |
| `phone`             | ุงูุชูุงู ุจู ุดูุงุฑู ููุจุงู                         | `recipient_phone`                                    |
| `contact`           | ุงูุชูุงู ุจู ูุฎุงุทุจ ุฐุฎุฑูโุดุฏู                   | `recipient_phone`, `metadata.contact_id`           |
| `wallet_address`    | ุงูุชูุงู ุจู ุขุฏุฑุณ ฺฉู ูพูู (24 ุฑูู)            | `metadata.wallet_address`                            |
| `qr`                | ุงูุชูุงู ุจุง QR Code                                         | `metadata.qr_payload`                                |
| `special_code`      | ุงูุชูุงู ุจุง ฺฉุฏ ุงุฎุชุตุงุต (ุจุฑุง ุฑุงููุฏฺฏุงู) | `metadata.special_code`                              |
| `link`              | ุงูุชูุงู ุจุง ููฺฉ ูพุฑุฏุงุฎุช                           | `metadata.payment_link_id`                           |
| `nfc`               | ุงูุชูุงู ุจุง NFC                                             | `metadata.nfc_data` ุง `metadata.wallet_address` |

---

### ๐งพ ุงูุชูุงู ุจุง QR (ฺฉุงููุงู ูุฑุญููโุง)

ุฏุฑ ุงูุชูุงู ุจุง QR ุณู ูุฑุญูู ุฏุงุฑุฏ: **ุชููุฏ QR**ุ **ููุงุด ุจู ฺฉุงุฑุจุฑ (ูุชุงุฏุชุง + ุชุตูุฑ)**ุ ู **ุงุฌุฑุง ุงูุชูุงู**.

#### 1. ุชููุฏ QR

```bash
POST /api/wallet/qr/generate/
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "amount": 60000,
  "description": "QR ุชุณุช",
  "expires_in": 600
}
```

**ูพุงุณุฎ:**

```json
{
  "qr_payload": "qr_54863A74B601",
  "qr_content": "PAYAQR:qr_54863A74B601",
  "qr_url": "https://nondefined-wilton-undeliberatively.ngrok-free.dev/api/wallet/qr/lookup/",
  "deeplink": "paya://wallet/qr/qr_54863A74B601",
  "amount": "60000.00",
  "description": "QR ุชุณุช",
  "expires_at": "2025-11-13T12:12:47.931261Z",
  "status": "active"
}
```

#### 2. ููุงุด ู ุขูุงุฏูโุณุงุฒ ุจุฑุง ุงูพูฺฉุดู (Flutter)

**ูุฑุญูู 1: ุจุฑุฑุณ ูุชุงุฏุชุง (Lookup)**

ูุจู ุงุฒ ููุงุด QR ุจู ฺฉุงุฑุจุฑุ ุจุงุฏ ุตุญุช ุขู ุฑุง ุจุฑุฑุณ ฺฉูุฏ:

```bash
POST /api/wallet/qr/lookup/
Content-Type: application/json

{
  "qr_payload": "qr_54863A74B601"
}
```

**ูพุงุณุฎ:**

```json
{
  "qr_payload": "qr_54863A74B601",
  "status": "active",
  "expires_at": "2025-11-13T12:12:47.931261Z",
  "amount": "60000.00",
  "description": "QR ุชุณุช",
  "qr_content": "PAYAQR:qr_54863A74B601",
  "owner": {
    "wallet_id": 2,
    "user_id": 5,
    "phone": "+989999847264",
    "fullname": ""
  },
  "metadata": {}
}
```

**ูุฑุญูู 2: ุฏุฑุงูุช ุชุตูุฑ QR (ุงุฎุชุงุฑ)**

ุงฺฏุฑ ูโุฎูุงูุฏ ุงุฒ ุณุฑูุฑ ุชุตูุฑ ุฑุง ุจฺฏุฑุฏ:

```bash
GET /api/wallet/qr/image/?qr_payload=qr_54863A74B601&size=512
Authorization: Bearer <access_token>
```

ูุงู PNG ุฑุง ูโุชูุงูุฏ ูุณุชููุงู ุจุง `Image.network` ููุงุด ุฏูุฏ.

#### 3. ุงุฌุฑุง ุงูุชูุงู ุจุง QR

**ุฏุฑ ุงูพูฺฉุดู Flutter:**

1. ฺฉุงุฑุจุฑ QR ุฑุง ุงุณฺฉู ูโฺฉูุฏ (ุจุง ุฏูุฑุจู)
2. ููุฏุงุฑ `PAYAQR:qr_54863A74B601` ุง ููุท `qr_54863A74B601` ุงุณุชุฎุฑุงุฌ ูโุดูุฏ
3. ูุจู ุงุฒ ุงูุชูุงูุ ุจุง `POST /api/wallet/qr/lookup/` ุตุญุช QR ุจุฑุฑุณ ูโุดูุฏ
4. ุงฺฏุฑ ููู ฺุฒ ุงูฺฉ ุจูุฏุ ฺฉุงุฑุจุฑ ุฏฺฉูู ยซูพุฑุฏุงุฎุชยป ุฑุง ูโุฒูุฏ
5. ุฏุฑุฎูุงุณุช ุงูุชูุงู ุงุฑุณุงู ูโุดูุฏ:

```json
{
  "method": "qr",
  "amount": 60000,
  "metadata": {
    "qr_payload": "qr_54863A74B601"
  }
}
```

**ูพุงุณุฎ ูููู:**

```json
{
  "transaction_id": "txn_9b85de7af096",
  "amount": "60000.00",
  "recipient": {
    "phone": "+989999847264",
    "fullname": ""
  },
  "balance_after": "11000.00",
  "status": "completed",
  "created_at": "2025-11-13T12:11:59.457448Z",
  "method": "qr",
  "metadata": {
    "qr_payload": "qr_54863A74B601",
    "qr_id": 5,
    "qr_owner_wallet_id": 2,
    "qr_owner_user_id": 5,
    "qr_fixed_amount": true,
    "method": "qr",
    "initiator_user_id": 3,
    "direction": "outgoing",
    "recipient_wallet_id": 2,
    "recipient_user_id": 5
  }
}
```

> **ูฺฉุชู:** ุงฺฏุฑ QR ูุจูุบ ุซุงุจุช ุฏุงุฑุฏุ `amount` ุฏุฑ ูุชุงุฏุชุง ุฐุฎุฑู ูโุดูุฏ ู ูุงุฒ ุจู ุงุฑุณุงู ุฏูุจุงุฑู ูุณุช. ุญุฏุงูู ูุจูุบ ุงูุชูุงู ฑฐูุฒุงุฑ ุชููุงู ุงุณุช.

---

### ๐ฑ ุงูุชูุงู ุจุง ุดูุงุฑู ููุจุงู (phone)

```json
{
  "method": "phone",
  "recipient_phone": "+989121234567",
  "amount": 50000,
  "description": "ุจุงุฒูพุฑุฏุงุฎุช ูุฑุถ",
  "metadata": {
    "note": "ุงูุชูุงู ุณุฑุน"
  }
}
```

---

### ๐ฅ ุงูุชูุงู ุจู ูุฎุงุทุจ (contact)

```json
{
  "method": "contact",
  "recipient_phone": "+989121234567",
  "amount": 75000,
  "metadata": {
    "contact_id": "cnt_42",
    "note": "ุงูุชูุงู ุจู ูุฎุงุทุจ ุฐุฎุฑูโุดุฏู"
  }
}
```

---

### ๐ฆ ุงูุชูุงู ุจู ุขุฏุฑุณ ฺฉู ูพูู (wallet_address) - 24 ุฑูู

ูุฑ ฺฉู ูพูู ฺฉ ุขุฏุฑุณ 24 ุฑูู ุฏุงุฑุฏ ฺฉู ุจุง `PAYA` ุดุฑูุน ูโุดูุฏ (ูุซูุงู `PAYA123456789012345678`).

```json
{
  "method": "wallet_address",
  "amount": 200000,
  "description": "ุงูุชูุงู ุจู ุขุฏุฑุณ ฺฉู ูพูู",
  "metadata": {
    "wallet_address": "PAYA123456789012345678"
  }
}
```

**ูฺฉุงุช:**

- ุขุฏุฑุณ ุจุงุฏ ุฏููุงู 24 ฺฉุงุฑุงฺฉุชุฑ ุจุงุดุฏ
- ุจุงุฏ ุจุง `PAYA` ุดุฑูุน ุดูุฏ
- ูโุชูุงูุฏ ุจุง ูุงุตูู ุง ุฎุท ุชุฑู ูู ุงุฑุณุงู ฺฉูุฏ (ูุซูุงู `PAYA 1234 5678 9012 3456 7890`)

---

### ๐ข ุงูุชูุงู ุจุง ฺฉุฏ ุงุฎุชุตุงุต (special_code)

ุงู ุฑูุด ุจุฑุง ุงูุชูุงู ูุฒุฑุง ุงุณุชูุงุฏู ูโุดูุฏ ฺฉู ฺฉุฏ ุงุฎุชุตุงุต ุฏุงุฑูุฏ. ูุฑ ูุฒุฑ ฺฉ ฺฉุฏ ุงุฎุชุตุงุต (ูุนูููุงู 5 ุฑูู) ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุจู ูุดุชุฑุงู ุจุฏูุฏ.

#### 1. ุฏุฑุงูุช ฺฉุฏ ุงุฎุชุตุงุต

ุฑุงููุฏู ูโุชูุงูุฏ ฺฉุฏ ุงุฎุชุตุงุต ุฎูุฏ ุฑุง ุฏุฑุงูุช ฺฉูุฏ:

```bash
GET /api/wallet/special-code/me/
Authorization: Bearer <access_token>
```

**ูพุงุณุฎ ูููู:**

```json
{
  "code": "12345",
  "is_active": true,
  "created_at": "2025-11-13T10:00:00Z",
  "updated_at": "2025-11-13T10:00:00Z"
}
```

**ุงฺฏุฑ ฺฉุฏ ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ:**

```json
{
  "detail": "Special code not found. Use POST /api/wallet/special-code/generate/ to create one."
}
```

#### 2. ุชููุฏ ฺฉุฏ ุงุฎุชุตุงุต

ุงฺฏุฑ ูุฒุฑ ฺฉุฏ ุงุฎุชุตุงุต ูุฏุงุดุชู ุจุงุดุฏ ุง ุจุฎูุงูุฏ ฺฉุฏ ุฌุฏุฏ ุชููุฏ ฺฉูุฏ:

```bash
POST /api/wallet/special-code/generate/
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "code": "12345"  // ุงุฎุชุงุฑ - ุงฺฏุฑ ุงุฑุณุงู ูุดูุฏุ ฺฉุฏ ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุชููุฏ ูโุดูุฏ
}
```

**ูฺฉุงุช:**

- ุงฺฏุฑ `code` ุงุฑุณุงู ูุดูุฏุ ฺฉ ฺฉุฏ 5 ุฑูู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุชููุฏ ูโุดูุฏ
- ุงฺฏุฑ `code` ุงุฑุณุงู ุดูุฏุ ุจุงุฏ ุจู 4 ุชุง 10 ุฑูู ุจุงุดุฏ ู ููุท ุดุงูู ุงุนุฏุงุฏ ุจุงุดุฏ
- ฺฉุฏ ุจุงุฏ ฺฉุชุง ุจุงุดุฏ (ุงฺฏุฑ ูุจูุงู ุงุณุชูุงุฏู ุดุฏู ุจุงุดุฏุ ุฎุทุง ุจุฑูโฺฏุฑุฏุงูุฏ)

**ูพุงุณุฎ ูููู:**

```json
{
  "code": "12345",
  "is_active": true,
  "created_at": "2025-11-13T10:00:00Z",
  "updated_at": "2025-11-13T10:00:00Z",
  "message": "ฺฉุฏ ุงุฎุชุตุงุต ุจุง ููููุช ุงุฌุงุฏ ุดุฏ"
}
```

**ุฎุทุงูุง ุงุญุชูุงู:**

- `Special code must contain only digits` - ฺฉุฏ ุจุงุฏ ููุท ุดุงูู ุงุนุฏุงุฏ ุจุงุดุฏ
- `Special code must be between 4 and 10 digits` - ุทูู ฺฉุฏ ุจุงุฏ ุจู 4 ุชุง 10 ุฑูู ุจุงุดุฏ
- `This code is already taken by another user` - ุงู ฺฉุฏ ูุจูุงู ุชูุณุท ฺฉุงุฑุจุฑ ุฏฺฏุฑ ุงุณุชูุงุฏู ุดุฏู ุงุณุช

#### 3. ุงูุชูุงู ุจุง ฺฉุฏ ุงุฎุชุตุงุต (ุจุฑุง ูุดุชุฑ)

ูุดุชุฑ ูโุชูุงูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉุฏ ุงุฎุชุตุงุต ุฑุงููุฏูุ ุจู ุงู ูพูู ูุงุฑุฒ ฺฉูุฏ:

```json
{
  "method": "special_code",
  "amount": 100000,
  "description": "ูพุฑุฏุงุฎุช ุจู ุฑุงููุฏู",
  "metadata": {
    "special_code": "12345"
  }
}
```

**ูฺฉุงุช:**

- ฺฉุฏ ุงุฎุชุตุงุต ุจุงุฏ ูุนุงู ุจุงุดุฏ
- ูโุชูุงูุฏ ฺฉุฏ ุฑุง ุจุง ูุงุตูู ุง ุฎุท ุชุฑู ูู ุงุฑุณุงู ฺฉูุฏ (ูุซูุงู `123 45` ุง `123-45`)
- ุญุฏุงูู ูุจูุบ: 10,000 ุชููุงู

**ูพุงุณุฎ ูููู:**

```json
{
  "transaction_id": "txn_abc123def456",
  "amount": "100000.00",
  "recipient": {
    "phone": "+989121234567",
    "fullname": "ุฑุงููุฏู"
  },
  "balance_after": "900000.00",
  "status": "completed",
  "created_at": "2025-11-13T12:40:12Z",
  "method": "special_code",
  "metadata": {
    "special_code": "12345",
    "driver_user_id": 5,
    "driver_wallet_id": 2
  }
}
```

**ุฎุทุงูุง ุงุญุชูุงู:**

- `special_code is required in metadata` - ฺฉุฏ ุงุฎุชุตุงุต ุฏุฑ metadata ุงุฑุณุงู ูุดุฏู ุงุณุช
- `Special code not found or inactive` - ฺฉุฏ ูพุฏุง ูุดุฏ ุง ุบุฑูุนุงู ุงุณุช
- `Recipient wallet not found` - ฺฉู ูพูู ุฑุงููุฏู ูพุฏุง ูุดุฏ
- `Cannot transfer to your own wallet` - ููโุชูุงูุฏ ุจู ุฎูุฏุชุงู ูพูู ุจูุฑุณุชุฏ
- `Insufficient balance` - ููุฌูุฏ ฺฉุงู ูุณุช

---

### ๐ ุงูุชูุงู ุจุง ููฺฉ ูพุฑุฏุงุฎุช (link)

ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ฺฉ ููฺฉ ูพุฑุฏุงุฎุช ุงุฌุงุฏ ฺฉูุฏ ู ุขู ุฑุง ุจู ุฏฺฏุฑุงู ุจูุฑุณุชุฏ. ููฺฉ ุดุงูู ูุจูุบ ูุดุฎุต ุงุณุช ู ููุท ฺฉ ุจุงุฑ ูุงุจู ุงุณุชูุงุฏู ุงุณุช.

#### 1. ุงุฌุงุฏ ููฺฉ ูพุฑุฏุงุฎุช

```bash
POST /api/wallet/link/generate/
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "amount": 300000,
  "description": "ุฏุฑุฎูุงุณุช ูพุฑุฏุงุฎุช",
  "expires_in": 3600
}
```

**ูฺฉุงุช:**

- `amount` (ุงุฌุจุงุฑ): ูุจูุบ ุฏุฑุฎูุงุณุช - ุญุฏุงูู 10,000 ุชููุงู
- `description` (ุงุฎุชุงุฑ): ุชูุถุญุงุช ููฺฉ
- `expires_in` (ุงุฎุชุงุฑ): ุฒูุงู ุงููุถุง ุจุฑ ุญุณุจ ุซุงูู - ูพุดโูุฑุถ 3600 (1 ุณุงุนุช)ุ ุญุฏุงฺฉุซุฑ 604800 (7 ุฑูุฒ)
- `metadata` (ุงุฎุชุงุฑ): ุงุทูุงุนุงุช ุงุถุงู

**ูพุงุณุฎ ูููู:**

```json
{
  "link_id": "pl_84479XzQdL",
  "link": "pl_84479XzQdL",
  "amount": "300000.00",
  "description": "ุฏุฑุฎูุงุณุช ูพุฑุฏุงุฎุช",
  "expires_at": "2025-11-13T13:12:47.931261Z",
  "status": "active"
}
```

**ูฺฉุชู ููู:**

- ููุฏ `link` ููุงู ุดูุงุณู ุงุฎุชุตุงุต ููฺฉ ุงุณุช (ูุซู `pl_84479XzQdL`)
- ุงู ุดูุงุณู ฺฉูุชุงู ู ูุงุจู ุงุณุชูุงุฏู ุฏุฑ ุงูพูฺฉุดู ุงุณุช
- ุงูพูฺฉุดู ูโุชูุงูุฏ ุงุฒ ุงู ุดูุงุณู ุจุฑุง ุณุงุฎุช deeplink ุงุณุชูุงุฏู ฺฉูุฏ (ูุซูุงู `paya://pay/pl_84479XzQdL`)
- ุง ูโุชูุงูุฏ ุขู ุฑุง ุจู ุตูุฑุช ูุณุชูู ุฏุฑ ุตูุญู ูพุฑุฏุงุฎุช ููุงุด ุฏูุฏ
- ูุฑูุช: `pl_` + 10 ฺฉุงุฑุงฺฉุชุฑ (ุญุฑูู ู ุงุนุฏุงุฏ)

**ุฎุทุงูุง ุงุญุชูุงู:**

- `Wallet not found` - ฺฉู ูพูู ูพุฏุง ูุดุฏ
- `Wallet is not active` - ฺฉู ูพูู ุบุฑูุนุงู ุงุณุช
- `Amount must be at least 10,000` - ูุจูุบ ฺฉูุชุฑ ุงุฒ ุญุฏุงูู ุงุณุช
- `expires_in must be between 60 and 604800` - ุฒูุงู ุงููุถุง ุฎุงุฑุฌ ุงุฒ ูุญุฏูุฏู ุงุณุช

#### 2. ุงูุชูุงู ุจุง ููฺฉ

```json
{
  "method": "link",
  "amount": 300000,
  "description": "ูพุฑุฏุงุฎุช ุงุฒ ุทุฑู ููฺฉ",
  "metadata": {
    "payment_link_id": "pl_54863A74B601"
  }
}
```

**ูฺฉุงุช:**

- ูุจูุบ ุจุงุฏ ุฏููุงู ุจุฑุงุจุฑ ุจุง ูุจูุบ ููฺฉ ุจุงุดุฏ
- ุงฺฏุฑ `amount` ุงุฑุณุงู ูุดูุฏุ ุงุฒ ูุจูุบ ููฺฉ ุงุณุชูุงุฏู ูโุดูุฏ
- ููฺฉ ููุท ฺฉ ุจุงุฑ ูุงุจู ุงุณุชูุงุฏู ุงุณุช
- ููฺฉ ูููุถ ุดุฏู ูุงุจู ุงุณุชูุงุฏู ูุณุช

**ูพุงุณุฎ ูููู:**

```json
{
  "transaction_id": "txn_abc123def456",
  "amount": "300000.00",
  "recipient": {
    "phone": "+989121234567",
    "fullname": "ฺฉุงุฑุจุฑ ุฏุฑุงูุชโฺฉููุฏู"
  },
  "balance_after": "700000.00",
  "status": "completed",
  "created_at": "2025-11-13T12:45:12Z",
  "method": "link",
  "metadata": {
    "payment_link_id": "pl_54863A74B601",
    "link_owner_wallet_id": 2,
    "link_owner_user_id": 5
  }
}
```

---

### ๐ก ุงูุชูุงู ุจุง NFC (nfc)

ุจุฑุง ุงูุชูุงู ุจุง ูุฒุฏฺฉ ฺฉุฑุฏู ุฏู ฺฏูุด ุจู ูู. **ุงู ูุงุจูุช ุจุงุฏ ุงุฒ ุณูุช Flutter ูพุงุฏูโุณุงุฒ ุดูุฏ.**

#### ูุญูู ฺฉุงุฑ NFC

1. **ุฏุฑ ุงูพูฺฉุดู Flutter:**

   - ฺฉุงุฑุจุฑ ูุฑุณุชูุฏู: ุฏฺฉูู "NFC ุขูุงุฏู ุงูุชูุงู" ุฑุง ูโุฒูุฏ
   - ฺฉุงุฑุจุฑ ฺฏุฑูุฏู: ฺฏูุด ุฎูุฏ ุฑุง ูุฒุฏฺฉ ฺฏูุด ูุฑุณุชูุฏู ูโฺฉูุฏ
   - Flutter ุงุฒ ุทุฑู NFCุ `wallet_address` ุง `phone` ฺฏุฑูุฏู ุฑุง ูโุฎูุงูุฏ
   - Flutter ุงู ุฏุงุฏู ุฑุง ุจู ุณุฑูุฑ ุงุฑุณุงู ูโฺฉูุฏ
2. **ุฏุฑ ุณุฑูุฑ:**

   - ุณุฑูุฑ ุฏุงุฏู ุฏุฑุงูุช ุฑุง ูพุฑุฏุงุฒุด ูโฺฉูุฏ
   - ุงฺฏุฑ `wallet_address` ุจุงุดุฏ (24 ฺฉุงุฑุงฺฉุชุฑ ุจุง `PAYA`)ุ ูุณุชููุงู ุงุณุชูุงุฏู ูโุดูุฏ
   - ุงฺฏุฑ `phone` ุจุงุดุฏุ ฺฉุงุฑุจุฑ ุฑุง ูพุฏุง ฺฉุฑุฏู ู ฺฉู ูพููุด ุฑุง ูโุงุจุฏ
   - ุงูุชูุงู ุงูุฌุงู ูโุดูุฏ

#### ุฏุฑุฎูุงุณุช ุงูุชูุงู

```json
{
  "method": "nfc",
  "amount": 50000,
  "description": "ุงูุชูุงู NFC",
  "metadata": {
    "nfc_data": "PAYA123456789012345678"
  }
}
```

ุง ุจุง ุดูุงุฑู ููุจุงู:

```json
{
  "method": "nfc",
  "amount": 50000,
  "description": "ุงูุชูุงู NFC",
  "metadata": {
    "nfc_data": "+989121234567"
  }
}
```

**ูฺฉุงุช ููู:**

- **ูพุงุฏูโุณุงุฒ NFC ุงุฒ ุณูุช Flutter:** Flutter ุจุงุฏ ุงุฒ ฺฉุชุงุจุฎุงูู NFC ุงุณุชูุงุฏู ฺฉูุฏ (ูุซูุงู `nfc_manager` ุง `flutter_nfc_kit`)
- **ุฏุงุฏู ุงุฑุณุงู:** Flutter ุจุงุฏ `wallet_address` (24 ุฑูู) ุง `phone` ุฑุง ุงุฒ ุทุฑู NFC ุจุฎูุงูุฏ ู ุจู ุณุฑูุฑ ุจูุฑุณุชุฏ
- **ูพุฑุฏุงุฒุด ุฏุฑ ุณุฑูุฑ:** ุงฺฏุฑ `nfc_data` ุจุง `PAYA` ุดุฑูุน ุดูุฏ ู 24 ฺฉุงุฑุงฺฉุชุฑ ุจุงุดุฏุ ุจู ุนููุงู `wallet_address` ูพุฑุฏุงุฒุด ูโุดูุฏ
- **ุฏุฑ ุบุฑ ุงู ุตูุฑุช:** ุจู ุนููุงู `phone` ูพุฑุฏุงุฒุด ูโุดูุฏ
- ูโุชูุงูุฏ ุงุฒ `wallet_address` ุจู ุฌุง `nfc_data` ุงุณุชูุงุฏู ฺฉูุฏ

**ูพุงุณุฎ ูููู:**

```json
{
  "transaction_id": "txn_abc123def456",
  "amount": "50000.00",
  "recipient": {
    "phone": "+989121234567",
    "fullname": "ฺฉุงุฑุจุฑ ุฏุฑุงูุชโฺฉููุฏู"
  },
  "balance_after": "950000.00",
  "status": "completed",
  "created_at": "2025-11-13T12:50:12Z",
  "method": "nfc",
  "metadata": {
    "nfc_data": "PAYA123456789012345678"
  }
}
```

**ุฎุทุงูุง ุงุญุชูุงู:**

- `nfc_data or wallet_address is required in metadata` - ุฏุงุฏู NFC ุงุฑุณุงู ูุดุฏู ุงุณุช
- `Recipient wallet not found` - ฺฉู ูพูู ฺฏุฑูุฏู ูพุฏุง ูุดุฏ
- `Recipient user not found` - ฺฉุงุฑุจุฑ ฺฏุฑูุฏู ูพุฏุง ูุดุฏ
- `Cannot transfer to your own wallet` - ููโุชูุงูุฏ ุจู ุฎูุฏุชุงู ูพูู ุจูุฑุณุชุฏ

**ูฺฉุชู ุจุฑุง ุชูุณุนูโุฏููุฏู Flutter:**

ุจุฑุง ูพุงุฏูโุณุงุฒ NFC ุฏุฑ Flutterุ ูโุชูุงูุฏ ุงุฒ ฺฉุชุงุจุฎุงููโูุง ุฒุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

- `nfc_manager`: ุจุฑุง ุฎูุงูุฏู ู ููุดุชู NFC tags
- `flutter_nfc_kit`: ุจุฑุง ฺฉุงุฑ ุจุง NFC ุฏุฑ Android ู iOS

ูุซุงู ฺฉุฏ Flutter (ููููู):

```dart
// ุฎูุงูุฏู wallet_address ุงุฒ NFC
String walletAddress = await readNFCData();
// ุงุฑุณุงู ุจู ุณุฑูุฑ
await transferMoney(
  method: 'nfc',
  amount: 50000,
  metadata: {'nfc_data': walletAddress}
);
```

---

### ุจุฑุฑุณ ูพุงุณุฎ

ุจุฑุง ููู ุฑูุดโูุง ูพุงุณุฎ ุงุณุชุงูุฏุงุฑุฏ ุจู ุดฺฉู ุฒุฑ ุงุณุช:

```json
{
  "transaction_id": "txn_123abc",
  "amount": "50000.00",
  "recipient": {
    "phone": "09121234567",
    "fullname": "ฺฉุงุฑุจุฑ ุฏุฑุงูุชโฺฉููุฏู"
  },
  "balance_after": "1250000.00",
  "status": "completed",
  "created_at": "2025-01-01T10:45:12Z",
  "method": "phone",
  "metadata": {
    "direction": "outgoing",
    "recipient_wallet_id": 123,
    "note": "ุงูุชูุงู ุณุฑุน"
  }
}
```

ูพุณ ุงุฒ ูุฑ ุงูุชูุงูุ ูโุชูุงูุฏ ุจุง `GET /api/wallet/transactions/` ููุฑุณุช ุชุฑุงฺฉูุดโูุง ุฑุง ูุดุงูุฏู ฺฉูุฏ.

---

## ๐ ุฎูุงุตู ุฑูุดโูุง ุงูุชูุงู

| ุฑูุด             | ูุถุนุช                     | ุชูุถุญ                                           |
| ------------------ | ------------------------------ | ---------------------------------------------------- |
| `phone`          | โ ูพุงุฏูโุณุงุฒ ุดุฏู | ุงูุชูุงู ุจุง ุดูุงุฑู ููุจุงู            |
| `contact`        | โ ูพุงุฏูโุณุงุฒ ุดุฏู | ุงูุชูุงู ุจู ูุฎุงุทุจ ุฐุฎุฑูโุดุฏู      |
| `wallet_address` | โ ูพุงุฏูโุณุงุฒ ุดุฏู | ุงูุชูุงู ุจุง ุขุฏุฑุณ 24 ุฑูู ฺฉู ูพูู |
| `qr`             | โ ูพุงุฏูโุณุงุฒ ุดุฏู | ุงูุชูุงู ุจุง QR Code                            |
| `special_code`   | โ ูพุงุฏูโุณุงุฒ ุดุฏู | ุงูุชูุงู ุจุง ฺฉุฏ ุงุฎุชุตุงุต ุฑุงููุฏู   |
| `link`           | โ ูพุงุฏูโุณุงุฒ ุดุฏู | ุงูุชูุงู ุจุง ููฺฉ ูพุฑุฏุงุฎุช              |
| `nfc`            | โ ูพุงุฏูโุณุงุฒ ุดุฏู | ุงูุชูุงู ุจุง NFC                                |

---

## ๐ ฺฏุฒุงุฑุด ุชุฑุงฺฉูุดโูุง (Transaction Report)

ุงู endpoint ุจุฑุง ููุงุด ฺฏุฒุงุฑุด ฺฉุงูู ุชุฑุงฺฉูุดโูุง ุฏุฑ ุงูพูฺฉุดู ููุจุงู ุงุณุชูุงุฏู ูโุดูุฏ. ุดุงูู ุฎูุงุตู ฺฉุงุฑุชโูุงุ ูููุฏุงุฑ ูุงูุงูู ู ูุณุช ุชุฑุงฺฉูุดโูุง ุงุณุช.

### ุฏุฑุงูุช ฺฏุฒุงุฑุด ุชุฑุงฺฉูุดโูุง

```bash
GET /api/wallet/report/
Authorization: Bearer <access_token>
```

### Query Parameters

| ูพุงุฑุงูุชุฑ | ููุน | ูพุดโูุฑุถ | ุชูุถุญ |
|---------|-----|---------|-------|
| `period` | string | `week` | ุจุงุฒู ุฒูุงู ุจุฑุง ูููุฏุงุฑ: `week` (ููุชูโุง) ุง `month` (ูุงูุงูู) |
| `weeks` | integer | `6` | ุชุนุฏุงุฏ ููุชูโูุง ุจุฑุง ููุงุด (ุฒูุงู ฺฉู `period=week`) |
| `months` | integer | `6` | ุชุนุฏุงุฏ ูุงูโูุง ุจุฑุง ููุงุด (ุฒูุงู ฺฉู `period=month`) |
| `start_date` | string | - | ุชุงุฑุฎ ุดุฑูุน (ISO format: `YYYY-MM-DD`) |
| `end_date` | string | - | ุชุงุฑุฎ ูพุงุงู (ISO format: `YYYY-MM-DD`) |
| `transaction_type` | string | `all` | ููุน ุชุฑุงฺฉูุด: `all`, `charge`, `debit`, `transfer_in`, `transfer_out` |
| `search` | string | - | ุฌุณุชุฌู ุฏุฑ ุชูุถุญุงุชุ transaction_id ุง reference_id |
| `page` | integer | `1` | ุดูุงุฑู ุตูุญู |
| `page_size` | integer | `20` | ุชุนุฏุงุฏ ุฏุฑ ูุฑ ุตูุญู |

### ูุซุงูโูุง ุงุณุชูุงุฏู

#### 1. ฺฏุฒุงุฑุด ูพุดโูุฑุถ (6 ููุชู ฺฏุฐุดุชู)

```bash
GET http://localhost:8000/api/wallet/report/
Authorization: Bearer <access_token>
```

**ูพุงุณุฎ ููููู:**

```json
{
  "summary": {
    "total_payments": "1800000.00",
    "total_receipts": "800000.00",
    "formatted_total_payments": "ฑ,ธฐฐ,ฐฐฐ ุชููุงู",
    "formatted_total_receipts": "ธฐฐ,ฐฐฐ ุชููุงู"
  },
  "chart_data": [
    {
      "period": "ููุชู ฑ",
      "payments": "500000.00",
      "receipts": "100000.00",
      "date": "2025-01-06"
    },
    {
      "period": "ููุชู ฒ",
      "payments": "300000.00",
      "receipts": "200000.00",
      "date": "2025-01-13"
    },
    {
      "period": "ููุชู ณ",
      "payments": "400000.00",
      "receipts": "150000.00",
      "date": "2025-01-20"
    },
    {
      "period": "ููุชู ด",
      "payments": "200000.00",
      "receipts": "180000.00",
      "date": "2025-01-27"
    },
    {
      "period": "ููุชู ต",
      "payments": "250000.00",
      "receipts": "120000.00",
      "date": "2025-02-03"
    },
    {
      "period": "ููุชู ถ",
      "payments": "150000.00",
      "receipts": "50000.00",
      "date": "2025-02-10"
    }
  ],
  "transactions": [
    {
      "id": 1,
      "transaction_id": "txn_abc123def456",
      "type": "charge",
      "type_display": "ุดุงุฑฺ",
      "amount": "5000000.00",
      "balance_before": "0.00",
      "balance_after": "5000000.00",
      "description": "ุดุงุฑฺ ฺฉู ูพูู",
      "status": "completed",
      "status_display": "ุชฺฉูู ุดุฏู",
      "created_at": "2025-01-15T10:30:00Z",
      "metadata": {},
      "recipient_info": null
    },
    {
      "id": 2,
      "transaction_id": "txn_xyz789ghi012",
      "type": "transfer_out",
      "type_display": "ุงุฑุณุงู ุงูุชูุงู",
      "amount": "250000.00",
      "balance_before": "5000000.00",
      "balance_after": "4750000.00",
      "description": "ุงูุชูุงู ุจู ุงุญูุฏ",
      "status": "completed",
      "status_display": "ุชฺฉูู ุดุฏู",
      "transfer_method": "phone",
      "created_at": "2025-01-15T11:00:00Z",
      "metadata": {},
      "recipient_info": {
        "phone": "+989121234567",
        "fullname": "ุงุญูุฏ"
      }
    }
  ],
  "total_transactions": 25,
  "has_more": true
}
```

#### 2. ฺฏุฒุงุฑุด ูุงูุงูู (6 ูุงู ฺฏุฐุดุชู)

```bash
GET http://localhost:8000/api/wallet/report/?period=month&months=6
Authorization: Bearer <access_token>
```

#### 3. ฺฏุฒุงุฑุด ุจุง ููุชุฑ ููุน ุชุฑุงฺฉูุด

```bash
GET http://localhost:8000/api/wallet/report/?transaction_type=transfer_out
Authorization: Bearer <access_token>
```

#### 4. ฺฏุฒุงุฑุด ุจุง ุฌุณุชุฌู

```bash
GET http://localhost:8000/api/wallet/report/  
Authorization: Bearer <access_token>
```

ุงู endpoint ุฏุฑ ุชูุถุญุงุชุ transaction_id ู reference_id ุฌุณุชุฌู ูโฺฉูุฏ.

#### 5. ฺฏุฒุงุฑุด ุจุง ุจุงุฒู ุฒูุงู ูุดุฎุต

```bash
GET http://localhost:8000/api/wallet/report/?start_date=2025-01-01&end_date=2025-01-31
Authorization: Bearer <access_token>
```

#### 6. ฺฏุฒุงุฑุด ุจุง pagination

```bash
GET http://localhost:8000/api/wallet/report/?page=2&page_size=10
Authorization: Bearer <access_token>
```

### ุณุงุฎุชุงุฑ ูพุงุณุฎ

- **summary**: ุฎูุงุตู ฺฉุงุฑุชโูุง
  - `total_payments`: ฺฉู ูพุฑุฏุงุฎุช (transfer_out + debit)
  - `total_receipts`: ฺฉู ุฏุฑุงูุช (transfer_in + charge + refund)
  - `formatted_total_payments`: ฺฉู ูพุฑุฏุงุฎุช ูุฑูุช ุดุฏู
  - `formatted_total_receipts`: ฺฉู ุฏุฑุงูุช ูุฑูุช ุดุฏู

- **chart_data**: ุฏุงุฏูโูุง ูููุฏุงุฑ
  - `period`: ุจุงุฒู ุฒูุงู (ูุซู "ููุชู ฑ" ุง "1403/05")
  - `payments`: ูุฌููุน ูพุฑุฏุงุฎุชโูุง ุฏุฑ ุงู ุจุงุฒู
  - `receipts`: ูุฌููุน ุฏุฑุงูุชโูุง ุฏุฑ ุงู ุจุงุฒู
  - `date`: ุชุงุฑุฎ ุดุฑูุน ุจุงุฒู

- **transactions**: ูุณุช ุชุฑุงฺฉูุดโูุง (ุจุง pagination)
  - ูุฑ ุชุฑุงฺฉูุด ุดุงูู ุชูุงู ุงุทูุงุนุงุช ุงุฒ TransactionSerializer ุงุณุช

- **total_transactions**: ุชุนุฏุงุฏ ฺฉู ุชุฑุงฺฉูุดโูุง (ุจุฏูู pagination)

- **has_more**: ุขุง ุตูุญู ุจุนุฏ ูุฌูุฏ ุฏุงุฑุฏุ

### ูฺฉุงุช ููู ุจุฑุง ุงูพูฺฉุดู Flutter

1. **ููุงุด ุฎูุงุตู:** ุงุฒ `summary.total_payments` ู `summary.total_receipts` ุจุฑุง ููุงุด ฺฉุงุฑุชโูุง ุฎูุงุตู ุงุณุชูุงุฏู ฺฉูุฏ.

2. **ูููุฏุงุฑ ุฎุท:** ุงุฒ `chart_data` ุจุฑุง ุฑุณู ูููุฏุงุฑ ุฎุท ุงุณุชูุงุฏู ฺฉูุฏ. ุฏุงุฏูโูุง ุจู ุชุฑุชุจ ุฒูุงู ูุฑุชุจ ุดุฏูโุงูุฏ.

3. **ูุณุช ุชุฑุงฺฉูุดโูุง:** ุงุฒ `transactions` ุจุฑุง ููุงุด ูุณุช ุงุณุชูุงุฏู ฺฉูุฏ. ุจุฑุง paginationุ ุงุฒ `has_more` ุจุฑุง ููุงุด ุฏฺฉูู "ูุดุงูุฏู ุจุดุชุฑ" ุงุณุชูุงุฏู ฺฉูุฏ.

4. **ููุชุฑูุง:** ฺฉุงุฑุจุฑ ูโุชูุงูุฏ ููุชุฑูุง ูุฎุชูู ุฑุง ุงุนูุงู ฺฉูุฏ (ููุน ุชุฑุงฺฉูุดุ ุจุงุฒู ุฒูุงูุ ุฌุณุชุฌู).

5. **ููุงุด ูุจุงูุบ:** ุงุฒ ููุฏูุง `formatted_total_payments` ู `formatted_total_receipts` ุจุฑุง ููุงุด ูุจุงูุบ ุจู ูุงุฑุณ ุงุณุชูุงุฏู ฺฉูุฏ.

---

## ๐ ุนุจโุงุจ

### ุฎุทุง: "Wallet not found"

- ฺฉู ูพูู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุณุงุฎุชู ูโุดูุฏ. ุงฺฏุฑ ูุฌูุฏ ูุฏุงุฑุฏุ ุงุฒ `POST /api/wallet/create/` ุงุณุชูุงุฏู ฺฉูุฏ.

### ุฎุทุง: "Insufficient balance"

- ููุฌูุฏ ฺฉู ูพูู ฺฉุงู ูุณุช. ุงุจุชุฏุง ฺฉู ูพูู ุฑุง ุดุงุฑฺ ฺฉูุฏ.

### ุฎุทุง: "QR code not found"

- QR ูููุถ ุดุฏู ุง ูุจูุงู ุงุณุชูุงุฏู ุดุฏู ุงุณุช. QR ุฌุฏุฏ ุชููุฏ ฺฉูุฏ.

### ุฎุทุง: "Wallet address must be exactly 24 characters"

- ุขุฏุฑุณ ฺฉู ูพูู ุจุงุฏ ุฏููุงู 24 ฺฉุงุฑุงฺฉุชุฑ ุจุงุดุฏ ู ุจุง `PAYA` ุดุฑูุน ุดูุฏ.



### Audit Logs

- `GET /api/management/core/audit-logs/` - ูุณุช ูุงฺฏโูุง
- `GET /api/management/core/audit-logs/{id}/` - ุฌุฒุฆุงุช ฺฉ ูุงฺฏ
- `GET /api/management/core/audit-logs/statistics/` - ุขูุงุฑ ูุงฺฏโูุง
- `GET /api/management/core/audit-logs/recent_failures/` - ูุงฺฏโูุง ูุงูููู ุงุฎุฑ
- `GET /api/management/core/audit-logs/security_events/` - ุฑูุฏุงุฏูุง ุงููุช

### Query Parameters

- `event_type`: ููุชุฑ ุจุฑ ุงุณุงุณ ููุน ุฑูุฏุงุฏ
- `result`: ููุชุฑ ุจุฑ ุงุณุงุณ ูุชุฌู
- `user_id`: ููุชุฑ ุจุฑ ุงุณุงุณ ฺฉุงุฑุจุฑ
- `user_phone`: ููุชุฑ ุจุฑ ุงุณุงุณ ุดูุงุฑู ุชููู
- `ip_address`: ููุชุฑ ุจุฑ ุงุณุงุณ IP
- `start_date`: ุชุงุฑุฎ ุดุฑูุน
- `end_date`: ุชุงุฑุฎ ูพุงุงู
- `request_id`: ููุชุฑ ุจุฑ ุงุณุงุณ request_id
- `page`: ุดูุงุฑู ุตูุญู
- `page_size`: ุชุนุฏุงุฏ ุฏุฑ ูุฑ ุตูุญู

---

**ุชุงุฑุฎ ุจูโุฑูุฒุฑุณุงู**: 2025-01-15
**ูฺฏูุฏุงุฑูุฏู**: Abolfazl Mohammadi
