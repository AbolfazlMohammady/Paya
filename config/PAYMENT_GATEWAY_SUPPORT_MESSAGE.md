# โ ูพุงุณุฎ ูพุดุชุจุงู ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช ุณูพูุฑ (ุตุงุฏุฑุงุช) - ุฑุงูููุง ูพุงุฏูโุณุงุฒ

> **ุชุงุฑุฎ ุฏุฑุงูุช ูพุงุณุฎ**: 18 ููุงูุจุฑ 2025  
> **ูุถุนุช**: โ ุงุทูุงุนุงุช API ุฏุฑุงูุช ุดุฏ - ูุงุฒ ุจู ุซุจุช IP ุณุฑูุฑ

ุณูุงู ู ููุช ุจุฎุฑ

ูพุณ ุงุฒ ุชูุงุณ ุจุง ูพุดุชุจุงู ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช ุณูพูุฑุ ุงุทูุงุนุงุช ุฒุฑ ุฑุง ุฏุฑุงูุช ฺฉุฑุฏู. ุงู ูุงู ุดุงูู ุฑุงูููุง ฺฉุงูู ูพุงุฏูโุณุงุฒ ู ูุฑุงุญู ุจุนุฏ ุงุณุช.

## ๐ ุงุทูุงุนุงุช ูพุฑูฺู

- **ูุงู ุณุณุชู**: ฺฉู ูพูู ูพุงุง (Paya Wallet)
- **ุฒุจุงู ุจุฑูุงููโููุณ**: Python (Django REST Framework)
- **ููุน ุงุชุตุงู**: REST API ุจุง JSON

## ๐ง ุชูุธูุงุช ูุนู

- **Terminal ID**: `98743989`
- **Callback URL**: `https://nondefined-wilton-undeliberatively.ngrok-free.dev/api/wallet/payment-callback/`
  - โ๏ธ **ุชูุฌู**: ุฏุฑ ุญุงู ุญุงุถุฑ ุงุฒ ngrok ุจุฑุง ุชุณุช ุงุณุชูุงุฏู ูโฺฉูู (ุญุงูุช ุชูุณุนู)
  - ุขุง ุฏุฑฺฏุงู ูโุชูุงูุฏ ุจุง ngrok ฺฉุงุฑ ฺฉูุฏุ
- **Invoice ID Format**: ุนุฏุฏ (ุญุฏุงฺฉุซุฑ 20 ุฑูู) - ุงุฒ timestamp + random number ุชููุฏ ูโุดูุฏ
- **ูุซุงู Invoice ID**: `1763440841346391` (16 ุฑููุ ุนุฏุฏ)

## ๐ก API ูุง ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช ุณูพูุฑ (ุทุจู ูพุงุณุฎ ูพุดุชุจุงู)

### 1. ุฏุฑุฎูุงุณุช GetToken (ุงุฌุงุฏ ุฏุฑุฎูุงุณุช ูพุฑุฏุงุฎุช)

**Endpoint**: `POST https://sepehr.shaparak.ir:8081/V1/PeymentApi/GetToken`

> โ๏ธ **ุชูุฌู**: ูพูุฑุช `8081` ู ูุณุฑ `/V1/` (ุจุฏูู `/Rest/`) ุงุณุช

**Headers**:
```
Content-Type: application/json
```

**Body (JSON)** (ูุซุงู ุงุฒ ูพุดุชุจุงู):
```json
{
  "TerminalID": "69000000",
  "Amount": "20000",
  "InvoiceID": "444",
  "callbackURL": "https://test.ir/Payment/PageCallBackSaderat",
  "payload": ""
}
```

**ูพุงุณุฎ ูููู**:
```json
{
  "Status": 0,
  "Accesstoken": "TOKEN_RECEIVED_FROM_GATEWAY",
  "Message": "ูููู"
}
```

**ูฺฉุงุช ููู**:
- โ **Terminal ID**: ุจุงุฏ ูุนุชุจุฑ ู ูุนุงู ุจุงุดุฏ
- โ **Amount**: ุจู **ุฑุงู** ุงุณุช (ูุซุงู: `20000` = 20,000 ุฑุงู = 2,000 ุชููุงู)
- โ **Invoice ID**: ูโุชูุงูุฏ ุนุฏุฏ ุณุงุฏู ุจุงุดุฏ (ูุซุงู: `444`)
- โ **callbackURL**: ุจุงุฏ URL ูุนุชุจุฑ ุจุงุดุฏ
- โ **payload**: ูโุชูุงูุฏ ุฎุงู (`""`) ุจุงุดุฏ

### 2. ูุฏุงุช ฺฉุงุฑุจุฑ ุจู ุตูุญู ูพุฑุฏุงุฎุช (ูุฑู POST)

**Endpoint**: `POST https://sepehr.shaparak.ir:8080/Pay`

> โ๏ธ **ุชูุฌู**: ูพูุฑุช `8080` ุงุณุช (ูู `8081`)

**ุฑูุด ุงุฑุณุงู**: ูุฑู HTML ุจุง POST

**ูุซุงู ูุฑู** (ุทุจู ูพุงุณุฎ ูพุดุชุจุงู):
```html
<form method="post" action="https://sepehr.shaparak.ir:8080/Pay">
  <div>
    <input type="text" name="TerminalID" value="69000000" />
    <input type="text" name="token" value="AccessToken" />
    <input name="getMethod" type="hidden" required="required" value="1">
    <input type="submit" value="ูพุฑุฏุงุฎุช" class="submit" />
  </div>
</form>
```

**ููุฏูุง ููุฑุฏ ูุงุฒ**:
- `TerminalID`: ุดูุงุฑู ุชุฑููุงู
- `token`: ุชูฺฉู ุฏุฑุงูุช ุดุฏู ุงุฒ GetToken (ููุฏุงุฑ `Accesstoken`)
- `getMethod`: ุจุงุฏ `1` ุจุงุดุฏ (hidden field)

**ูฺฉุชู**: ุฏุฑ ฺฉุฏ Python/Djangoุ ูโุชูุงูุฏ ุจู ุฌุง ูุฑู HTMLุ ฺฉุงุฑุจุฑ ุฑุง ุจู ุงู URL ุจุง ูพุงุฑุงูุชุฑูุง GET ูุฏุงุช ฺฉูุฏ ุง ุงุฒ redirect ุงุณุชูุงุฏู ฺฉูุฏ.

### 3. Callback ุงุฒ ุฏุฑฺฏุงู

**Endpoint ูุง**: `POST https://nondefined-wilton-undeliberatively.ngrok-free.dev/api/wallet/payment-callback/`

**ุงูุชุธุงุฑ ูุง**: ุฏุฑฺฏุงู ุจุงุฏ ุจู ุงู URL ฺฉ POST request ุจุฒูุฏ ุจุง Query Parameters ุง Body

**ุณูุงูุงุช**:
1. โ ุฏุฑฺฏุงู callback ุฑุง ุจู ฺู ุฑูุด ุงุฑุณุงู ูโฺฉูุฏุ (GET ุง POSTุ Query Parameters ุง JSON Bodyุ)
2. โ ฺู ููุฏูุง ุฏุฑ callback ุงุฑุณุงู ูโุดูุฏุ
   - ุขุง `Authority` (ุชูฺฉู ุงุฒ GetToken) ุงุฑุณุงู ูโุดูุฏุ
   - ุขุง `respcode` ุงุฑุณุงู ูโุดูุฏุ (0 ุจุฑุง ููููุ)
   - ุขุง `invoiceid` ุงุฑุณุงู ูโุดูุฏุ
   - ุขุง `digitalreceipt` ุงุฑุณุงู ูโุดูุฏุ
3. โ ุขุง Callback URL ุจุงุฏ ุญุชูุงู **ูุจู ุงุฒ ุงุฑุณุงู GetToken ุฏุฑ ูพูู ุซุจุช ุดุฏู ุจุงุดุฏ**ุ
4. โ ุขุง ูโุชูุงูู ุงุฒ ngrok ุจุฑุง ุชุณุช ุงุณุชูุงุฏู ฺฉููุ (URL ูุฑ ุจุงุฑ ุชุบุฑ ูโฺฉูุฏ)

### 4. ุฏุฑุฎูุงุณุช Advice (ุชุงุฏ ูพุฑุฏุงุฎุช)

**Endpoint**: `POST https://sepehr.shaparak.ir:8081/V1/PeymentApi/Advice`

> โ๏ธ **ุชูุฌู**: ูพูุฑุช `8081` ู ูุณุฑ `/V1/` (ุจุฏูู `/Rest/`) ุงุณุช

**Headers**:
```
Content-Type: application/json
```

**Body (JSON)** (ูุซุงู ุงุฒ ูพุดุชุจุงู):
```json
{
  "digitalreceipt": "b1b5c2a0-4b51-49ae-815a-4159a1700b3e",
  "Tid": "69000000"
}
```

**ูฺฉุงุช ููู**:
- โ ูุงู ููุฏ `Tid` ุตุญุญ ุงุณุช (ูู `TerminalID`)
- โ `digitalreceipt`: ุงู ููุฏ ุงุฒ callback ุฏุฑฺฏุงู ุฏุฑุงูุช ูโุดูุฏ (ูู `Authority`)
- โ `Tid`: ุดูุงุฑู ุชุฑููุงู

## โ๏ธ ุฑุงูโุญู ุฎุทุง Status: -2 (ููู!)

**ุทุจู ูพุงุณุฎ ูพุดุชุจุงู**:

> ุฌูุช ุฑูุน ุฎุทุง ุณุงุฎุช ุชูฺฉู 2- ูุทูุง IP ุตุญุญ ุงุชุตุงู ุจู ุฏุฑฺฏุงู ูพุฑุฏุงุฎุช ุฑุง ุงุฒ ูุงุณุช ุฏุฑุงูุช ู ุจุฑุง ุงุถุงูู ูููุฏู ุฏุฑ ุฏุชุง ุจุณ ููุฑุงู ุจุง ุดูุงุฑู ุชุฑููุงู ุฎูุฏ ุงุฑุณุงู ฺฉูุฏ.

### ๐ง ูุฑุงุญู ุฑูุน ุฎุทุง:

1. **ุฏุฑุงูุช IP ุณุฑูุฑ**: ุจุงุฏ IP ุนููู ุณุฑูุฑ ฺฉู ุฏุฑุฎูุงุณุชโูุง ุงุฒ ุขู ุงุฑุณุงู ูโุดูุฏ ุฑุง ุฏุฑุงูุช ฺฉูุฏ
2. **ุงุฑุณุงู ุจู ูพุดุชุจุงู**: IP + ุดูุงุฑู ุชุฑููุงู ุฑุง ุจู ูพุดุชุจุงู ุงุฑุณุงู ฺฉูุฏ
   - **Email**: ipg3@sepehrpay.com
   - **Subject**: ุซุจุช IP ุจุฑุง ุชุฑููุงู
   - **ูุญุชูุง**: 
     ```
     ุดูุงุฑู ุชุฑููุงู: 98743989
     IP ุณุฑูุฑ: [IP_PUBLIC_SERVER]
     ```
3. **ุงูุชุธุงุฑ ุจุฑุง ุชุงุฏ**: ูพุณ ุงุฒ ุซุจุช IP ุฏุฑ ุฏุชุงุจุณ ุฏุฑฺฏุงูุ ุฎุทุง Status: -2 ุจุฑุทุฑู ูโุดูุฏ

### ๐ ูุญูู ุฏุฑุงูุช IP ุนููู ุณุฑูุฑ:

**ุฑูุด 1: ุงุฒ ุณุฑูุฑ ุฎูุฏ**:
```bash
curl ifconfig.me
# ุง
curl ipinfo.io/ip
```

**ุฑูุด 2: ุงุฒ Python**:
```python
import requests
ip = requests.get('https://api.ipify.org').text
print(ip)
```

**ูฺฉุชู ููู**: ุงฺฏุฑ ุงุฒ ngrok ุงุณุชูุงุฏู ูโฺฉูุฏุ ุจุงุฏ IP ุณุฑูุฑ ุงุตู (ูู IP ngrok) ุฑุง ุงุฑุณุงู ฺฉูุฏ.

## โ ูุฑุงุญู ุจุนุฏ (ุงูุฏุงูุงุช ููุฑุฏ ูุงุฒ)

### 1. ุซุจุช IP ุณุฑูุฑ ุฏุฑ ุฏุฑฺฏุงู (ุงูููุช ุงูู)

**ุงูุฏุงู ููุฑ**:
1. IP ุนููู ุณุฑูุฑ ุฑุง ุฏุฑุงูุช ฺฉูุฏ
2. ุจู ูพุดุชุจุงู ุงูู ุจุฒูุฏ:
   - **To**: ipg3@sepehrpay.com
   - **Subject**: ุซุจุช IP ุจุฑุง ุชุฑููุงู 98743989
   - **ูุญุชูุง**:
     ```
     ุณูุงู
     
     ูุทูุงู IP ุฒุฑ ุฑุง ุจุฑุง ุชุฑููุงู 98743989 ุฏุฑ ุฏุชุงุจุณ ุซุจุช ฺฉูุฏ:
     
     ุดูุงุฑู ุชุฑููุงู: 98743989
     IP ุณุฑูุฑ: [IP_PUBLIC_SERVER]
     
     ุจุง ุชุดฺฉุฑ
     ```

### 2. ุจูโุฑูุฒุฑุณุงู ฺฉุฏ (ุชุบุฑ URL ูุง API)

ุจุงุฏ ุฏุฑ ฺฉุฏ Python/Django ุชุบุฑุงุช ุฒุฑ ุฑุง ุงุนูุงู ฺฉูุฏ:

**ุชุบุฑุงุช ููุฑุฏ ูุงุฒ**:
1. โ URL GetToken: `https://sepehr.shaparak.ir:8081/V1/PeymentApi/GetToken`
2. โ URL Payment Form: `https://sepehr.shaparak.ir:8080/Pay`
3. โ URL Advice: `https://sepehr.shaparak.ir:8081/V1/PeymentApi/Advice`

**ูุงูโูุง ูุงุฒ ุจู ุชุบุฑ**:
- `config/wallet/payment_gateway.py` (ุฎุท 73 ู 88)

## โ๏ธ ูุถุนุช ูุนู ูพุฑูฺู

- โ ุฏุฑ ุญุงูุช **ุชูุณุนู (Development)** ูุณุชู
- โ ุงุฒ **ngrok** ุจุฑุง ุชุณุช ุงุณุชูุงุฏู ูโฺฉูู (ุฏุงููู ูุฏุงุฑู)
- โ ุณุณุชู ุดุฎุต/ูพุฑูฺู ุดุฎุต ุงุณุช
- โ **ุงุทูุงุนุงุช API ุงุฒ ูพุดุชุจุงู ุฏุฑุงูุช ุดุฏ**
- โ๏ธ **ูุงุฒ ุจู ุซุจุช IP ุณุฑูุฑ ุฏุฑ ุฏุฑฺฏุงู** (ุจุฑุง ุฑูุน ุฎุทุง Status: -2)
- โ๏ธ **ูุงุฒ ุจู ุจูโุฑูุฒุฑุณุงู URL ูุง API ุฏุฑ ฺฉุฏ**

## ๐ฏ ูุฑุงุญู ูพุงุฏูโุณุงุฒ (ฺฺฉโูุณุช)

### โ ูุฑุงุญู ุงูุฌุงู ุดุฏู:
- [x] ุฏุฑุงูุช ุงุทูุงุนุงุช API ุงุฒ ูพุดุชุจุงู
- [x] ูุณุชูุฏุณุงุฒ API endpoints

### โณ ูุฑุงุญู ุฏุฑ ุญุงู ุงูุฌุงู:
- [ ] ุฏุฑุงูุช IP ุนููู ุณุฑูุฑ
- [ ] ุงุฑุณุงู IP + Terminal ID ุจู ูพุดุชุจุงู
- [ ] ุจูโุฑูุฒุฑุณุงู URL ูุง API ุฏุฑ ฺฉุฏ

### ๐ ูุฑุงุญู ุจุนุฏ (ูพุณ ุงุฒ ุซุจุช IP):
- [ ] ุชุณุช ุฏุฑุฎูุงุณุช GetToken
- [ ] ูพุงุฏูโุณุงุฒ ูุฑู POST ุจุฑุง ูุฏุงุช ฺฉุงุฑุจุฑ
- [ ] ุชุณุช Callback ุงุฒ ุฏุฑฺฏุงู
- [ ] ูพุงุฏูโุณุงุฒ Advice ุจุฑุง ุชุงุฏ ูพุฑุฏุงุฎุช
- [ ] ุชุณุช ฺฉุงูู ูุฑุงูุฏ ูพุฑุฏุงุฎุช

---

## ๐ ุงุทูุงุนุงุช ุชูุงุณ ูพุดุชุจุงู

- **Email**: ipg3@sepehrpay.com
- **ููุถูุน ุงูู**: ุซุจุช IP ุจุฑุง ุชุฑููุงู 98743989

---

## ๐ ุฎูุงุตู ุชุบุฑุงุช ููุฑุฏ ูุงุฒ ุฏุฑ ฺฉุฏ

### 1. ุชุบุฑ URL GetToken:
```python
# ูุจู:
token_url = 'https://sepehr.shaparak.ir/Rest/V1/PeymentApi/GetToken'

# ุจุนุฏ:
token_url = 'https://sepehr.shaparak.ir:8081/V1/PeymentApi/GetToken'
```

### 2. ุชุบุฑ URL Payment Form:
```python
# ูุจู:
payment_url = 'https://sepehr.shaparak.ir/Payment/Pay'

# ุจุนุฏ:
payment_url = 'https://sepehr.shaparak.ir:8080/Pay'
```

### 3. ุชุบุฑ URL Advice:
```python
# ูุจู:
advice_url = 'https://sepehr.shaparak.ir/Rest/V1/PeymentApi/Advice'

# ุจุนุฏ:
advice_url = 'https://sepehr.shaparak.ir:8081/V1/PeymentApi/Advice'
```

### 4. ุชุบุฑ ูุฑู POST:
ุจุงุฏ ุงุฒ ูุฑู HTML ุจุง ููุฏูุง `TerminalID`, `token`, `getMethod=1` ุงุณุชูุงุฏู ุดูุฏ.

---

**ููููู ุงุฒ ุตุจุฑ ู ฺฉูฺฉ ุดูุง! ๐**

